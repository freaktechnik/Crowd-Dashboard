<!DOCTYPE html>
<html manifest="dashboard.appcache">
    <head>
        <meta charset="utf-8">
        
        <!--
            Crowd Dashboard
            Created 2013 by Martin Giger
            Licensed under GPLv2
          -->

        <title>Dashboard</title>

        <script type="text/javascript" src="crowd-dashboard.js"></script>
        <script type="text/javascript">
            "use strict";

            var statusDashboard;
            window.onload = function() {
                function loadDataForDashboard(fileURL,dashboard) {
                    var xhr = new XMLHttpRequest();
                    xhr.onreadystatechange = function() {
                        if( xhr.readyState == 4 && xhr.status != 0 && xhr.status < 400 )
                            dashboard.setServers(JSON.parse(xhr.response));
                        else
                            dashboard.setServers([]);
                    };

                    xhr.open('GET',fileURL);
                    xhr.send();
                }

                statusDashboard = new Dashboard();
                loadDataForDashboard("servers.json",statusDashboard);

                // set up the mirrors list
                var mirrorsDashboard = new Dashboard();
                mirrorsDashboard.setTarget('mirrors');
                mirrorsDashboard.onready = function() {
                    if(mirrorsDashboard.count == 0)
                        document.getElementById('mirrorsWrapper').classList.add('hidden');
                };

                loadDataForDashboard("mirrors.json",mirrorsDashboard);
            };

            function refresh(dashboard) {
                dashboard.checkServers();
            }
        </script>

        <style type="text/css">
            ul, ul li {
                list-style-type: none;
                margin-left: 0;
                padding-left: 0;
            }
        
            .offline {
                background-color: red;
                color: white;
            }
            .offline a:link, .offline a:visited {
                color: white;
            }
            
            .online {
                // style for services that are alive
            }
            .hidden {
                visibility: hidden;
                display: none;
            }

            #mirrors ul, #mirrors ul li {
                float: right;
            }
        </style>
    </head>
    <body>
        <h1>Dashboard</h1>
        <button onclick="refresh(statusDashboard);">Refresh</button>
        <div id="crowd-dashboard-status-list">
        </div>
        <footer>
            <a href="https://github.com/freaktechnik/Crowd-Dashboard">Source on GitHub</a>
            <section id="mirrorsWrapper">Mirrors: <div id="mirrors"></div></section>
        </footer>
    </body>
</html>